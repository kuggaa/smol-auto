{
  "provisioners": [
    {
      "type": "shell",
      "scripts": [
        "scripts/devel-repo.sh",
        "scripts/build-essential.sh",
        "scripts/linux-headers.sh",
        "scripts/virtualbox.sh",
        "scripts/j-tu-devel.sh",
        "scripts/rm-udev-persisten-net.sh",
        "scripts/passwd1.sh"
      ],
      "override": {
        "virtualbox-iso": {
          "execute_command": "echo '11111111' | sudo -S bash '{{.Path}}'"
        }
      }
    }
  ],
  "builders": [
    {
      "type": "virtualbox-iso",
      "boot_command": [
        "<esc><ecs><down><esc><enter><wait><wait>",
        "install auto=true vga=788 url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg <wait>",
        "debian-installer/locale=en_US console-keymaps-at/keymap=ru <wait>",
        "hostname=astravbox domain=local <wait>",
        "astra-license/license=true <wait>",
        "initrd=/netinst/initrd.gz <enter><wait>"
      ],
      "boot_wait": "3s",
      "disk_size": 16000,
      "hard_drive_interface": "sata",
      "iso_interface": "sata",
      "guest_os_type": "Debian_64",
      "headless": "{{user `headless`}}",
      "vm_name":"sudcm",
      "output_directory":"export",
      "http_directory": "http",
      "iso_checksum": "010c0d2c073f186a268de61339f9772d",
      "iso_checksum_type": "none",
      "iso_url": "/home/vgol/iso-image/smolensk-current.iso",
      "ssh_username": "u",
      "ssh_password": "qwertyui",
      "ssh_port": 22,
      "ssh_wait_timeout": "30m",
      "shutdown_command": "echo 'halt -p' > shutdown.sh; echo '11111111' | sudo -S bash 'shutdown.sh'",
      "guest_additions_path": "VBoxGuestAdditions_{{.Version}}.iso",
      "virtualbox_version_file": ".vbox_version",
      "export_opts" : [ "--ovf20", "--options", "manifest" ],
      "format": "ova",
      "vboxmanage": [
        [ "modifyvm", "{{.Name}}", "--cpus", "2", "--cpuexecutioncap", "90" ],
        [ "modifyvm", "{{.Name}}", "--pae", "on", "--ioapic", "on", "--chipset", "ich9" ],

        [ "modifyvm", "{{.Name}}", "--memory", "2048" ],

        [ "modifyvm", "{{.Name}}", "--vram", "32" ],
        [ "modifyvm", "{{.Name}}", "--accelerate2dvideo", "on" ],

        [ "modifyvm", "{{.Name}}", "--audio", "alsa" ],
        [ "modifyvm", "{{.Name}}", "--nictype1", "virtio" ],

        [ "storagectl", "{{.Name}}", "--name", "SATA Controller", "--hostiocache", "on" ],
        [ "storagectl", "{{.Name}}", "--name", "IDE Controller", "--remove" ],

        [ "modifyvm", "{{.Name}}", "--usbehci", "on" ],

        [ "modifyvm", "{{.Name}}", "--vrde", "on", "--vrdeauthtype", "external", "--vrdeauthlibrary", "VBoxAuth" ]
      ],
      "vboxmanage_post": [
        [ "modifyvm", "{{.Name}}", "--accelerate3d", "on" ],
        [ "modifyvm", "{{.Name}}", "--accelerate2dvideo", "off" ],
        [ "sharedfolder", "add", "{{.Name}}", "--name", "git", "--hostpath", "/home/vgol/git", "--automount" ],
        [ "sharedfolder", "add", "{{.Name}}", "--name", "svn", "--hostpath", "/home/vgol/svn", "--automount" ],

        [ "storageattach", "{{.Name}}", "--storagectl", "SATA Controller", "--port", "1", "--type", "dvddrive", "--medium", "emptydrive" ],
        [ "modifyvm", "{{.Name}}", "--vrde", "off" ],
        [ "modifyvm", "{{.Name}}", "--mouse", "usb" ],
        [ "modifyvm", "{{.Name}}", "--cableconnected1", "on" ],
        [ "modifyvm", "{{.Name}}", "--hostonlyadapter1", "vboxnet0" ],
        [ "modifyvm", "{{.Name}}", "--macaddress1", "080027E187C4" ] 
      ]
    }
  ]
}
